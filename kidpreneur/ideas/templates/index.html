{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}NeoHive Kids{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bungee+Outline&family=TASA+Orbiter:wght@400..800&display=swap" rel="stylesheet">

<style>
  :root {
    --radius: 0.5rem;
    --shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
    --theme-start: #2196f3;
    --theme-end: #90caf9;
  }

  body {
  background: url("{% static 'images/doodle-bg2.png' %}"); 
  background-size: 300px 300px; 
}

  #animationOverlay {
    position: fixed;
    inset: 0;
    background: white;
    background: url("{% static 'images/doodle-bg2.png' %}");
    background-size: cover;
    z-index: 1050;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    pointer-events: none;
    overflow: hidden;
    color: inherit;
  }

  .hero-text {
    font-family: "Bungee Outline", sans-serif;
    font-weight: 800;
    font-size: 3.5rem;
    margin-top: 3rem;
    user-select: none;
    white-space: nowrap;
    border-right: 0.15em solid currentColor;
    overflow: hidden;
    max-width: 0;
    opacity: 0;
    transition: opacity 10ms ease-in;
    color: currentColor;
  }

  #animationOverlay.hero-animate .hero-text {
    opacity: 1;
  }

  @keyframes blink-caret {
    0%, 100% { border-color: transparent; }
    50% { border-color: currentColor; }
  }

  .hero-text.typing {
    animation: blink-caret 100ms step-end infinite;
    border-right: 0.15em solid currentColor;
  }

  #animationOverlay.fade-out {
    opacity: 0;
    pointer-events: none;
    transition: opacity 100ms ease;
  }

  .hero-gradient {
    border-radius: var(--radius);
    padding: 3rem 1.5rem;
    text-align: center;
    color: white;
    background: linear-gradient(135deg, var(--theme-start), var(--theme-end));
    box-shadow: var(--shadow);
    transition: background 0.3s ease;
    margin-bottom: 3rem;
  }

  .carousel-wrapper {
    margin-top: 0;
    padding-top: 2rem;
  }

  .theme-red   .hero-gradient { --theme-start: #ff1744; --theme-end: #ff8a80; color: black; }
  .theme-yellow .hero-gradient { --theme-start: #ffc107; --theme-end: #fff176; color: black; }
  .theme-blue  .hero-gradient { --theme-start: #2196f3; --theme-end: #90caf9; color: black; }
  .theme-green .hero-gradient { --theme-start: #00c853; --theme-end: #69f0ae; color: black; }
  .theme-pink  .hero-gradient { --theme-start: #e91e63; --theme-end: #f48fb1; color: black; }
  .theme-purple .hero-gradient { --theme-start: #9c27b0; --theme-end: #ce93d8; color: black; }
  .theme-orange .hero-gradient { --theme-start: #ff7043; --theme-end: #ffab91; color: black; }

  .hero-gradient .btn {
    margin-top: 1rem;
  }
</style>
{% endblock %}

{% block content %}
<div id="animationOverlay" aria-hidden="true" role="presentation">
  <div class="hero-text think" aria-hidden="true" data-text="Think."></div>
  <div class="hero-text create" aria-hidden="true" data-text="Create."></div>
  <div class="hero-text launch" aria-hidden="true" data-text="Launch!"></div>
</div>

<div class="dashboard-container" style="visibility: hidden;" id="dashboardContent">
  <section class="hero-gradient">
    <img src="{% static 'images/rocket.png' %}" alt="Rocket" width="80" class="mb-3" loading="lazy">
    <h1 class="fw-bold display-5">Think. Create. Launch! üöÄ</h1>
    <p class="fs-5 mt-2">A space where kids share startup ideas and grow big dreams!</p>
    <div class="d-flex justify-content-center gap-3 mt-4 flex-wrap">
      <a href="{% url 'dashboard' %}" class="btn btn-fun-blue">üöÄ Let‚Äôs Get Started!</a>
      <a href="{% url 'search' %}" class="btn btn-fun-yellow">üåü Explore Ideas</a>
    </div>
  </section>

  <br><br><br>

  <section class="carousel-wrapper text-center">
    <h2 class="fw-bold mb-4">Most Loved Ideas üí°</h2>

    {% if top_ideas %}
    <div id="ideasCarousel" class="carousel slide carousel-dark mx-auto" data-bs-ride="carousel" data-bs-interval="5000" style="width: 1100px;">
      <div class="carousel-indicators">
        {% for idea in top_ideas %}
          <button type="button" data-bs-target="#ideasCarousel" data-bs-slide-to="{{ forloop.counter0 }}"
            {% if forloop.first %}class="active"{% endif %}
            aria-label="Slide {{ forloop.counter }}"></button>
        {% endfor %}
      </div>

      <div class="carousel-inner rounded shadow-sm">
        {% for idea in top_ideas %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}">
          <a href="{% url 'idea-detail' idea.slug %}" style="text-decoration:none; color: #000;">
            <div class="card-custom idea-card mx-auto p-4" style="max-width: 90%;">
              <h1 style="font-weight:800">{{ idea.title }}</h1>
              <p style="font-weight:200; padding: 5px 10px">{{ idea.description|truncatechars:180 }}</p>
              <div class="chip">‚ù§Ô∏è {{ idea.num_likes|intcomma }} likes</div>
              <div class="meta mt-3 d-flex justify-content-between align-items-center">
                {% if user.is_authenticated %}
                {% else %}
                  <a href="{% url 'login' %}" class="btn btn-outline-secondary">Login to Like</a>
                {% endif %}
              </div>
            </div>
          </a>
        </div>
        {% endfor %}
      </div>

      <button class="carousel-control-prev" type="button" data-bs-target="#ideasCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#ideasCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
    {% else %}
      <p class="empty">No ideas yet ‚Äî be the first to share one! üåü</p>
    {% endif %}
  </section>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const savedTheme = localStorage.getItem("dashboardTheme");
  const container = document.querySelector(".dashboard-container");
  const overlay = document.getElementById("animationOverlay");

  if (savedTheme && container) {
    container.classList.add(`theme-${savedTheme}`);

    // Map theme -> overlay text color
    const themeColors = {
      red: "#ff1744",
      yellow: "#ffc107",
      blue: "#2196f3",
      green: "#00c853",
      pink: "#e91e63",
      purple: "#9c27b0",
      orange: "#ff7043",
    };

    if (themeColors[savedTheme]) {
      overlay.style.color = themeColors[savedTheme];
    }
  }

  const dashboardContent = document.getElementById("dashboardContent");
  const texts = Array.from(overlay.querySelectorAll(".hero-text"));

  function typeText(element, text, delay = 100) {
    return new Promise((resolve) => {
      element.textContent = "";
      element.style.maxWidth = "0";
      element.classList.add("typing");
      let i = 0;

      function type() {
        if (i < text.length) {
          element.textContent += text.charAt(i);
          element.style.maxWidth = `${element.textContent.length}ch`;
          i++;
          setTimeout(type, delay);
        } else {
          element.classList.remove("typing");
          resolve();
        }
      }
      type();
    });
  }

  async function playAnimation() {
    overlay.style.pointerEvents = "none";
    for (const el of texts) {
      const text = el.dataset.text;
      await typeText(el, text, 120);
      await new Promise((r) => setTimeout(r, 600));
    }
    overlay.classList.add("fade-out");
    dashboardContent.style.visibility = "visible";
  }

  setTimeout(() => {
    overlay.classList.add("hero-animate");
    playAnimation();
  }, 100);
});
</script>
{% endblock %}
