{% extends "base.html" %}
{% load static %}
{% block title %}Dashboard{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<style>
  .dashboard-container {
    display: flex;
    flex-direction: row;
    gap: 20px;
    padding: 20px;
    flex-wrap: wrap;
    transition: background 0.3s ease, color 0.3s ease;
  }

  .theme-yellow { background: #fffbea; color: #664d03; }
  .theme-blue { background: #e7f1ff; color: #084298; }
  .theme-green { background: #e9f7ef; color: #0f5132; }
  .theme-pink { background: #fde2e9; color: #702459; }
  .theme-purple { background: #f3e8ff; color: #4a148c; }
  .theme-orange { background: #fff4e5; color: #7c2d12; }
  .theme-danger { background: #f8d7da; color: #842029; }

  .tab-section {
    width: 3%;
    min-width: 80px;
  }

  .tab-scroll-wrapper {
    overflow-y: auto;
    max-height: 90vh;
  }

  .nav-tabs {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .nav-tabs .nav-link {
    text-align: center;
    padding: 10px;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .content-section {
    flex: 1;
    min-width: 250px;
  }

  .card-custom {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    background-color: #fff;
    margin-bottom: 20px;
  }

  .idea-card {
    background-color: #ffffffb3;
  }

  .profile .info-item {
    margin-bottom: 8px;
  }

  .profile i,
  .profile svg,
  .card-custom i,
  .card-custom svg {
    color: currentColor;
    vertical-align: middle;
    margin-right: 6px;
  }

  #updateFormContainer form {
    background: #f9f9f9;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }

  #updateFormContainer input,
  #updateFormContainer select {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  #updateFormContainer button {
    margin-top: 10px;
  }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container" id="dashboardContainer">
  <div class="tab-section">
    <div class="tab-scroll-wrapper">
      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#ideas">ğŸ’¡</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#starred">â­</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#archived">ğŸ—‚ï¸</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#create">â•</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#custom">ğŸ¨</button></li>
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#profile">ğŸ‘¤</button></li>
      </ul>
    </div>
  </div>

  <div class="content-section">
    <div class="tab-content p-3 card-custom">
      
      <div class="tab-pane fade" id="ideas">
        <h3>ğŸ’¡ My Ideas</h3>
        {% for idea in ideas %}
          <div class="card-custom idea-card mb-3">
            <a href="{% url 'idea-detail' idea.slug %}" style="text-decoration:none; color: inherit;">
              <b><h2>{{ idea.title }}</h2></b>
              <p>{{ idea.description|truncatewords:15 }}</p>
              <div class="d-flex justify-content-between align-items-center mt-2">
                <small>By <b>{{ idea.user.username }}</b> â€¢ {{ idea.created_at|date:"M d, Y" }}</small>
                <span>ğŸ‘ {{ idea.likes.count }}</span>
              </div>
            </a>
            <div class="mt-2 d-flex gap-2">
              <a href="{% url 'idea_update' idea.slug %}" class="btn btn-sm btn-primary">Edit</a>
              <button class="btn btn-sm btn-warning open-action-modal" data-action="archive" data-id="{{ idea.id }}">Archive</button>
            </div>
          </div>
        {% empty %}
          <p>No ideas yet.</p>
        {% endfor %}
      </div>

      <div class="tab-pane fade" id="starred">
        <h3>â­ Starred Ideas</h3>
        {% for idea in starred_ideas %}
          <a href="{% url 'idea-detail' idea.slug %}" style="text-decoration:none">
            <div class="card-custom idea-card mb-3">
              <b><h2>{{ idea.title }}</h2></b>
              <p>{{ idea.description|truncatewords:15 }}</p>
              <div class="d-flex justify-content-between align-items-center mt-2">
                <small>By <b>{{ idea.user.username }}</b> â€¢ {{ idea.created_at|date:"M d, Y" }}</small>
                <span>ğŸ‘ {{ idea.likes.count }}</span>
              </div>
            </div>
          </a>
        {% empty %}
          <p>You havenâ€™t starred any ideas yet.</p>
        {% endfor %}
      </div>

      <div class="tab-pane fade" id="archived">
        <h3>ğŸ—‚ï¸ Archived Ideas</h3>
        {% for idea in archived_ideas %}
          <div class="card-custom idea-card mb-3">
            <b><h2>{{ idea.title }}</h2></b>
            <p>{{ idea.description|truncatewords:15 }}</p>
            <div class="d-flex justify-content-between align-items-center mt-2">
              <small>By <b>{{ idea.user.username }}</b> â€¢ {{ idea.created_at|date:"M d, Y" }}</small>
              <span>ğŸ‘ {{ idea.likes.count }}</span>
            </div>
            <div class="mt-2 d-flex gap-2">
              <button class="btn btn-sm btn-warning open-action-modal" data-action="unarchive" data-id="{{ idea.id }}">Unarchive</button>
              <button class="btn btn-sm btn-danger open-action-modal" data-action="delete" data-id="{{ idea.id }}">Delete</button>
            </div>
          </div>
        {% empty %}
          <p>No archived ideas yet.</p>
        {% endfor %}
      </div>

      <div class="tab-pane fade" id="create">
        <h3>â• Create New Idea</h3>
        <br>
        <a href="{% url 'idea_create' %}" class="create-idea-card" style="text-decoration:none;">
          <div class="text">
            <h4>Create Your Next Idea</h4>
            <p>Click here to launch your creativity and share your idea with the world!</p>
          </div>
        </a>
      </div>

      <div class="tab-pane fade" id="custom">
        <h3>ğŸ¨ Customize Dashboard Theme</h3>
        <br>
        <form id="themeForm">
          <div class="mb-3">
            <label for="themeSelect" class="form-label"><b>Select Theme:</b></label>
            <select id="themeSelect" class="form-select">
              <option value="theme-yellow">Yellow</option>
              <option value="theme-blue">Blue</option>
              <option value="theme-green">Green</option>
              <option value="theme-pink">Pink</option>
              <option value="theme-purple">Purple</option>
              <option value="theme-orange">Orange</option>
              <option value="theme-danger">Red</option>
            </select>
          </div>
        </form>
      </div>

      <div class="tab-pane fade show active" id="profile">
        <h3>ğŸ‘¤ My Profile</h3>

        <div class="row g-3 mb-4">
          <div class="col-md-3">
            <div class="card-custom text-center">
              <i class="bi bi-lightbulb-fill fs-3"></i>
              <div><b>Total Ideas</b></div>
              <div>{{ ideas|length }}</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card-custom text-center">
              <i class="bi bi-star-fill fs-3"></i>
              <div><b>Starred</b></div>
              <div>{{ starred_ideas|length }}</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card-custom text-center">
              <i class="bi bi-archive-fill fs-3"></i>
              <div><b>Archived</b></div>
              <div>{{ archived_ideas|length }}</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card-custom text-center">
              <i class="bi bi-hand-thumbs-up-fill fs-3"></i>
              <div><b>Total Likes</b></div>
              <div>{{ total_likes }}</div>
            </div>
          </div>
        </div>

        <div class="card-custom profile mt-3">
          <div class="info-item"><i class="bi bi-person-circle"></i><b>Username:</b> {{ request.user.username }}</div>
          <div class="info-item"><i class="bi bi-envelope"></i><b>Email:</b> {{ request.user.email }}</div>
          <div class="info-item"><i class="bi bi-person-fill"></i><b>First Name:</b> {{ request.user.first_name }}</div>
          <div class="info-item"><i class="bi bi-person-fill"></i><b>Last Name:</b> {{ request.user.last_name }}</div>
          <div class="info-item"><i class="bi bi-phone"></i><b>Phone:</b> {{ request.user.phone_number|default:"N/A" }}</div>
          <div class="info-item"><i class="bi bi-calendar"></i><b>Date of Birth:</b> {{ request.user.dob|default:"N/A" }}</div>
          <div class="info-item"><i class="bi bi-clock-history"></i><b>Days Since Joined:</b> {{ days_since_joined }}</div>
          <div class="info-item"><i class="bi bi-graph-up"></i><b>Student:</b>
            {% if request.user.is_student %}
              Yes
              <div class="info-item"><i class="bi bi-mortarboard"></i><b>School:</b> {{ request.user.school_name|default:"N/A" }}</div>
            {% else %}
              No
            {% endif %}
          </div>

          <div class="mt-3">
            <button id="toggleUpdateForm" class="btn btn-outline-primary w-100">âœï¸ Update Profile</button>
          </div>

          <div id="updateFormContainer" style="display:none; margin-top:15px;">
            <form method="POST">
              {% csrf_token %}
              <input type="hidden" name="profile_update" value="1">
              {{ user_form.as_p }}
              <button type="submit" class="btn btn-outline-success w-100 mt-2">ğŸ’¾ Save Changes</button>
            </form>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const container = document.getElementById("dashboardContainer");
    const savedTheme = localStorage.getItem("dashboardTheme");
    if (savedTheme) {
      container.classList.add(savedTheme);
      document.getElementById("themeSelect").value = savedTheme;
    } else {
      container.classList.add("theme-yellow");
    }

    document.getElementById("themeSelect").addEventListener("change", (e) => {
      const newTheme = e.target.value;
      container.classList.forEach(cls => {
        if (cls.startsWith("theme-")) container.classList.remove(cls);
      });
      container.classList.add(newTheme);
      localStorage.setItem("dashboardTheme", newTheme);
      location.reload();
    });

    const toggleUpdate = document.getElementById("toggleUpdateForm");
    if (toggleUpdate) {
      toggleUpdate.addEventListener("click", () => {
        const formContainer = document.getElementById("updateFormContainer");
        const visible = formContainer.style.display === "block";
        formContainer.style.display = visible ? "none" : "block";
        toggleUpdate.textContent = visible ? "âœï¸ Update Profile" : "âŒ Cancel Update";
      });
    }
  });
</script>
{% endblock %}
