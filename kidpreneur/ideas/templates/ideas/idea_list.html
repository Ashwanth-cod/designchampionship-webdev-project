{% extends 'base.html' %}
{% block title %}Search{% endblock %}

{% block content %}
<div class="container mt-4">

    <!-- Search Bar -->
    <input type="text" id="search-input" class="form-control mb-3" placeholder="Search Ideas, Users, Categories...">

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3" id="search-tabs">
        <li class="nav-item">
            <a class="nav-link active" data-tab="ideas" href="#">Ideas</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-tab="users" href="#">Users</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-tab="categories" href="#">Categories</a>
        </li>
    </ul>

    <!-- Results -->
    <div id="search-results"></div>

</div>

<script>
let activeTab = 'ideas';
const input = document.getElementById('search-input');
const resultsDiv = document.getElementById('search-results');
const tabs = document.querySelectorAll('#search-tabs .nav-link');

// Switch tabs
tabs.forEach(tab => {
    tab.addEventListener('click', function(e){
        e.preventDefault();
        tabs.forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        activeTab = this.dataset.tab;
        fetchResults(input.value);
    });
});

// Fetch results dynamically
function fetchResults(query){
    fetch(`{% url 'search' %}?q=${query}&tab=${activeTab}`)
    .then(res => res.json())
    .then(data => {
        let html = '';
        if(activeTab === 'ideas'){
            if(data.ideas.length){
                html += '<div class="row">';
                data.ideas.forEach(idea => {
                    html += `<div class="col-md-4 mb-3">
                                <div class="card h-100 shadow-sm">
                                ${idea.logo ? `<img src="${idea.logo}" class="card-img-top" style="height:180px; object-fit:cover;">` : ''}
                                    <div class="card-body d-flex flex-column">
                                        <h5 class="card-title">${idea.name}</h5>
                                        <p class="card-subtitle text-muted">${idea.category}</p>
                                        <p class="card-text mt-2">${idea.description}</p>
                                        <div class="mt-auto d-flex justify-content-between align-items-center">
                                            <span>üëç ${idea.likes}</span>
                                            <a href="/idea/${idea.slug}/" class="btn btn-sm btn-primary">View</a>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                });
                html += '</div>';
            } else {
                html = '<p>No ideas found.</p>';
            }
        } else if(activeTab === 'users'){
            if(data.users.length){
                html += '<ul class="list-group">';
                data.users.forEach(user => {
                    html += `<li class="list-group-item"><strong>${user.username}</strong> - ${user.first_name} ${user.last_name}</li>`;
                });
                html += '</ul>';
            } else {
                html = '<p>No users found.</p>';
            }
        } else if(activeTab === 'categories'){
            if(data.categories.length){
                html += '<ul class="list-group">';
                data.categories.forEach(cat => {
                    html += `<li class="list-group-item">${cat}</li>`;
                });
                html += '</ul>';
            } else {
                html = '<p>No categories found.</p>';
            }
        }
        resultsDiv.innerHTML = html;
    });
}

// Trigger search while typing
input.addEventListener('input', () => {
    fetchResults(input.value);
});

// Load initial results
fetchResults('');
</script>
{% endblock %}
