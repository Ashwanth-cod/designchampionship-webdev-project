{% extends "base.html" %}
{% block title %}{{ idea.title|slice:":20" }} - Idea{% endblock %}
{% block content %}
{% load humanize %}

<style>
  .idea-container {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    margin-top: 20px;
  }

  .card-custom {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .card-custom:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  }

  .likes button, .report button, .star-btn {
    width: 100%;
    font-size: 1rem;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 10px;
    transition: all 0.25s ease-in-out;
  }

  /* Star styles */
  .star-btn {
    background-color: #f8f9fa;
    border: 2px solid #ffc107;
    color: #ffc107;
    font-weight: bold;
  }

  .star-btn.starred {
    background-color: #ffc107;
    color: #fff;
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4);
  }

  .star-btn:hover {
    transform: scale(1.08);
  }

  .idea-description {
    white-space: pre-line; /* ‚úÖ preserve line breaks */
  }
</style>

<div class="idea-container">
  <!-- Left side -->
  <div>
    <div class="card-custom description">
      <h2>{{ idea.title }}</h2>
      <p class="idea-description">{{ idea.description }}</p>
    </div>
    <br><br>
    <div class="card-custom author">
      <p>
        By <strong>
          {% if idea.created_by == request.user %}
            <a href="{% url 'dashboard' %}" style="text-decoration:none;">
              {{ idea.created_by.username }}
            </a>
          {% else %}
            <a href="{% url 'user-profile' idea.created_by.username %}" style="text-decoration:none;">
              {{ idea.created_by.username }}
            </a>
          {% endif %}
        </strong>
        <br>
        <small>{{ idea.created_at|date:"M d, Y" }}</small>
      </p>
    </div>
  </div>

  <!-- Right side -->
  <div>
    <div class="card-custom likes mb-3">
      <!-- Like (server-side) -->
      <form method="post">
        {% csrf_token %}
        <button name="like_toggle" value="1" 
          class="btn {% if user_liked %}btn-danger{% else %}btn-outline-danger{% endif %}">
          {% if user_liked %}üíî Unlike{% else %}‚ù§Ô∏è Like{% endif %}
          {{ like_count }} <!-- ‚úÖ show correct like count -->
        </button>
      </form>

      <!-- Star (client-side only) -->
      <button id="starBtn" class="star-btn">
        ‚≠ê Star this idea
      </button>

      <!-- Report -->
      <form method="post" class="report">
        {% csrf_token %}
        <button name="report_toggle" value="1" class="btn btn-warning">
          üö© Report
        </button>
      </form>
    </div>

    <!-- Comments -->
    <div class="card-custom comments">
      <h4>Comments</h4>
      <form method="post" class="mb-3">
        {% csrf_token %}
        <textarea name="comment_text" class="form-control mb-2" placeholder="Add a comment..."></textarea>
        <button type="submit" class="btn btn-success">Submit</button>
      </form>
      {% for comment in comments %}
        <div class="comment-item">   
          <strong>
            {% if comment.user == request.user %}
              <a href="{% url 'dashboard' %}" style="text-decoration:none;">
                {{ comment.user.username }}
              </a>
            {% else %}
              <a href="{% url 'user-profile' comment.user.username %}" style="text-decoration:none;">
                {{ comment.user.username }}
              </a>
            {% endif %}
          </strong>
          <small class="text-muted"> ‚Ä¢ {{ comment.created_at|naturaltime }}</small>
          <p class="mb-0">{{ comment.text }}</p>
        </div>
      {% empty %}
        <p class="text-muted">No comments yet.</p>  
      {% endfor %}
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const starBtn = document.getElementById("starBtn");
    const storageKey = "starred_{{ idea.id }}";

    // Load state
    if (localStorage.getItem(storageKey) === "true") {
      starBtn.classList.add("starred");
      starBtn.innerText = "‚≠ê Unstar this idea";
    }

    // Toggle star
    starBtn.addEventListener("click", function() {
      const isStarred = starBtn.classList.toggle("starred");
      if (isStarred) {
        starBtn.innerText = "‚≠ê Unstar this idea";
        localStorage.setItem(storageKey, "true");
      } else {
        starBtn.innerText = "‚≠ê Star this idea";
        localStorage.removeItem(storageKey);
      }
    });
  });
</script>

{% endblock %}
