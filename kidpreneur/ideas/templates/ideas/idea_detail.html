{% extends "base.html" %}
{% block title %}{{ idea.name }} - Idea{% endblock %}
{% block content %}
<div class="card mb-4">
  <div class="card-body">
    <h2>{{ idea.name }}</h2>
    <p class="text-muted">By {{ idea.created_by.username }} | {{ idea.created_at|date:"M d, Y" }}</p>
    <p>{{ idea.description }}</p>

    <!-- Like -->
    <form method="post" class="d-inline">
      {% csrf_token %}
      <button name="like_toggle" value="1" class="btn {% if user_liked %}btn-danger{% else %}btn-outline-danger{% endif %}">
        ❤️ {% if user_liked %}Unlike{% else %}Like{% endif %} ({{ idea.likes.count }})
      </button>
    </form>

    <!-- Rating -->
    <form method="post" class="d-inline ms-3">
      {% csrf_token %}
      <select name="rating_value" class="form-select d-inline w-auto">
        {% for i in "12345" %}
          <option value="{{ i }}" {% if avg_rating|floatformat:0 == i %}selected{% endif %}>{{ i }}⭐</option>
        {% endfor %}
      </select>
      <button type="submit" class="btn btn-outline-primary">Rate</button>
    </form>

    <p class="mt-2">Average Rating: {{ avg_rating }}⭐</p>
  </div>
</div>

<!-- Comments -->
<div class="card">
  <div class="card-header"><h4>Comments</h4></div>
  <div class="card-body">
    <form method="post">
      {% csrf_token %}
      <textarea name="comment_text" class="form-control mb-2" placeholder="Add a comment..."></textarea>
      <button type="submit" class="btn btn-success">Submit</button>
    </form>
    <hr>
    {% for comment in comments %}
      <div class="mb-3">
        <strong>{{ comment.user.username }}</strong> <small class="text-muted">{{ comment.created_at|naturaltime }}</small>
        <p>{{ comment.text }}</p>
      </div>
    {% empty %}
      <p>No comments yet.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
